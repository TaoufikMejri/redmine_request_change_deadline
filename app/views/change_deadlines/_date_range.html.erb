<% query = @query %>
<%= hidden_field_tag 'set_filter', '1' %>
<%= hidden_field_tag 'type', @query.type, :disabled => true, :id => 'query_type' %>
<%= query_hidden_sort_tag(@query) %>


<div id="query_form_content" class="easy-query-filter-container with-freetext">

  <div class="easy-query-heading">
    <div class="buttons contextual">
      <div class="filters open" id="easy-query-toggle-button-filters">
        <a href="javascript:void(0);">
          <i class="icon-toggler"></i>
          Filters            <span class="default-filter">              default</span>        </a>

      </div>
      <script type="application/javascript">
          //<![CDATA[
          EasyGem.schedule.late(function(){
              $("#easy-query-toggle-button-filters").bind('click', function(e, el) {
                  EASY.utils.toggleDivAndChangeOpen('filters', "#easy-query-toggle-button-filters");
                  EASY.query.toggleFilterButtons('filter_buttons', '.easy-query-filter-toggle');
              });
          }, 0);
          //]]>
      </script>         <div class="settings" id="easy-query-toggle-button-settings">
      <a href="javascript:void(0);">
        <i class="icon-toggler"></i>
        Options          </a>
    </div>
      <script type="application/javascript">
          //<![CDATA[
          EasyGem.schedule.late(function(){
              $("#easy-query-toggle-button-settings").bind('click', function(e, el) {
                  EASY.utils.toggleDivAndChangeOpen('filters_settings', "#easy-query-toggle-button-settings");
                  EASY.query.toggleFilterButtons('filter_buttons', '.easy-query-filter-toggle');
              });
          }, 0);
          //]]>
      </script>    </div>


  </div>

  <div class="easy-query-filter-settings">
    <div id="filters" class="easy-query-filter-toggle gray-background filters collapsible" style="display: block;">

      <div id="easyquery-filters" class="easyquery-filters">
        <div class="add-filter tabular">
          <p>
            <label>Add filter:</label>
          <div id="query_form_with_buttons" class="hide-when-print">
            <div id="query_form_content">
              <fieldset id="filters" class="collapsible <%= @query.new_record? ? "" : "collapsed" %>">
                <legend onclick="toggleFieldset(this);"><%= l(:label_filter_plural) %></legend>
                <div style="<%= @query.new_record? ? "" : "display: none;" %>">
                  <%= render :partial => 'queries/filters', :locals => {:query => @query} %>
                </div>
              </fieldset>
            </div>
          </div>
          </p>
        </div>

      </div>

    </div>
    <div id="filters_settings" class="easy-query-filter-toggle gray-background others collapsible collapsed" style="display: none;">

      <div id="outputs_settings">
        <div class="list_settings output-settigs-box" data-output="list" style="">
          <%= render partial: 'column_query', locals: {query: @query, options: {}} %>
        </div>

      </div>
    </div>
  </div>



  <p id="filter_buttons" class="form-actions filter-buttons" style="display: block;">
    <%= link_to_function l(:button_apply), '$("#query_form").submit()', :class => 'icon icon-checked apply-link button-positive' %>

    <a class="icon icon-reload clear-link button-negative" title="By clicking reload default filter" href="/change_deadlines?set_filter=0">Default filters</a>
    <a href="#" onclick="EASY.query.applyFilters($('#query_form').attr('action'), '', $('#query_form .query-form-addtional-hidden-fields input:hidden').serialize()); return false;" class="icon icon-save save-link button" title="By clicking save this filter for further use." back_url="/change_deadlines?set_filter=1">Save</a>
  </p>

</div>